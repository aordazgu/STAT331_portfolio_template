---
title: "STAT 331 Portfolio"
author: "Arturo Ordaz-Gutierrez"
theme: pulse
format: html 
embed-resources: true
layout: margin-left
editor: visual
execute: 
  eval: false
  echo: true
---

[**My Grade:**]{.underline} I believe my grade equivalent to course work evidenced below to be an \_C+\_.

[**Learning Objective Evidence:**]{.underline} In the code chunks below, provide code from Lab or Challenge assignments where you believe you have demonstrated proficiency with the specified learning target. Be sure to specify **where** the code came from (e.g., Lab 4 Question 2).

## Working with Data

**WD-1: I can import data from a *variety* of formats (e.g., csv, xlsx, txt, etc.).**

-   `csv` Example 1

```{r}
#| label: wd-1-csv-1
# Lab 2: Question 1

surveys <- readr::read_csv(
  file = here::here(
    "Week2",
    "Lab2",
    "surveys.csv"
  )
)
```

-   `csv` Example 2

```{r}
#| label: wd-1-csv-2
# Lab 3: Question 2

teacher_evals <- read_csv(
  file = here::here(
    'Week3', 
    'Lab3', 
    'teacher_evals.csv'
    )
  )
```

-   `xlsx`

```{r}
#| label: wd-1-xlsx
# Week 2: Check-in 2.2

ages <- read_xlsx(
  file = here::here(
    "Week2",
    "Check-in",
    "Ages_Data",
    "ages.xlsx"),
  sheet = "ages", 
  skip  = 0, 
  n_max = 6
  )

```

-   `txt`

```{r}
#| label: wd-1-txt
# Week 2: Check-in 2.3

ages_space <- read_table(
  file = here::here(
    "Week2",
    "Check-in",
    "Ages_Data",
    "ages_space.txt"),
  col_names = TRUE)

```

**WD-2: I can select necessary columns from a dataset.**

-   Example selecting specified columns

```{r}
#| label: wd-2-ex-1
# Lab 3: Question 5

teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants >= 10) |>
  mutate(
    teacher_id   = as.character(teacher_id),
    course_id    = as.character(course_id)
  ) |>
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
  )
```

-   Example removing specified columns

```{r}
#| label: wd-2-ex-2
# Lab 7: Question 3

missing_summary <- fish |>
  group_by(year, section, trip) |>
  summarise(
    across(everything(), \(x) sum(is.na(x))),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols      = -c(year, section, trip),
    names_to  = "variable",
    values_to = "num_missing"
  )

```

-   Example selecting columns based on logical values (e.g., `starts_with()`, `ends_with()`, `contains()`, `where()`)

```{r}
#| label: wd-2-ex-3
# Lab 3: Question 8

teacher_evals_clean |>
  filter(if_any(ends_with("_avg"), ~ is.na(.x))) |>
  summarize(
    across(ends_with("_avg"), ~ sum(is.na(.))),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols      = ends_with("_avg"),
    names_to  = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0)

teacher_evals_clean |>
  filter(if_any(where(is.numeric), ~ is.na(.x))) |>
  select(
    teacher_id, course_id, question_no,
    where(is.numeric)
  )
```

**WD-3: I can filter rows from a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-3-numeric-ex-1
# Lab 3: Question 5

teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants >= 10) |>
  mutate(
    teacher_id   = as.character(teacher_id),
    course_id    = as.character(course_id)
  ) |>
  select(
    course_id, teacher_id, question_no, no_participants, resp_share,
    SET_score_avg, percent_failed_cur, academic_degree, seniority, sex
  )
```

-   Numeric Example 2

```{r}
#| label: wd-3-numeric-ex-2
# Lab 4: Question 5

income_2008_2018 <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(census_region, study_year) |>
  summarise(
    median_income_2018_dollars = median(mhi_2018, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from   = study_year,
    values_from  = median_income_2018_dollars,
    names_prefix = "Median income (2018 dollars) - "
  ) |>
  arrange(desc(`Median income (2018 dollars) - 2018`))

income_2008_2018

```

-   Character Example 1 (any context)

```{r}
#| label: wd-3-character
# Lab 4: Question 2

ca_childcare <- counties |>
  filter(state_name == "California") |>
  inner_join(childcare_costs,
             by = join_by(county_fips_code == county_fips_code))
```

-   Character Example 2 (example must use functions from **stringr**)

```{r}
#| label: wd-3-string
# Lab 5: Identify the Two Witnesses

witnesses <- person |>
  filter(
    (address_street_name == "Northwestern Dr" &
       address_number == max(address_number[address_street_name == "Northwestern Dr"])) |
      (address_street_name == "Franklin Ave" & str_detect(name, "Annabel"))
  ) |>
  select(id, name, address_number, address_street_name)

witness_interviews <- witnesses |>
  left_join(interview, by = c("id" = "person_id")) |>
  select(name, transcript) |>
  filter(!is.na(transcript))

witness_interviews
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-3-date
# Lab 5: Gym Activity

get_fit_now_check_in |>
  mutate(check_in_date = ymd(check_in_date)) |>
  filter(membership_id %in% suspect_member$id,
         check_in_date == ymd("2018-01-09"))
```

**WD-4: I can modify existing variables and create new variables in a dataframe for a *variety* of data types (e.g., numeric, integer, character, factor, date).**

-   Numeric Example 1

```{r}
#| label: wd-4-numeric-ex-1
# Lab 3: Question 7

teacher_evals_clean |>
  distinct(teacher_id, .keep_all = TRUE) |>
  count(academic_degree, sex) |>
  mutate(percent = round(100 * n / sum(n), 1)) |>
  arrange(desc(percent))
```

-   Numeric Example 2

```{r}
#| label: wd-4-numeric-ex-2
# Lab 5: Find Who Hired Jeremy Bowers

facebook_event_checkin <- facebook_event_checkin |>
  mutate(date = ymd(date))

concert_attendees <- facebook_event_checkin |>
  filter(
    event_name == "SQL Symphony Concert",
    month(date) == 12,
    year(date) == 2017
  ) |>
  count(person_id, name = "n_checkins", sort = TRUE) |>
  filter(n_checkins >= 3)

concert_attendees

```

-   Factor Example 1 (renaming levels)

```{r}
#| label: wd-4-factor-ex-1
# Lab 4: Question 4

ca_childcare <- ca_childcare |> 
  mutate(
    county_name = str_remove(county_name, " County"),
    census_region = fct_collapse(
      .f = county_name,
      superior      = superior_counties,
      north_coast   = north_coast_counties,
      san_francisco = san_fran_counties,
      n_san_joaquin = n_san_joaquin_counties,
      central_coast = central_coast_counties,
      s_san_joaquin = s_san_joaquin_counties,
      inland        = inland_counties,
      la            = la_county,
      orange        = orange_county,
      san_diego_imperial = san_diego_imperial_counties
    )
  )

```

-   Factor Example 2 (reordering levels)

```{r}
#| label: wd-4-factor-ex-2
# Lab 5: Find Initial Suspect

suspect_member <- get_fit_now_member |>
  mutate(
    membership_status = fct_relevel(
      membership_status,
      "bronze", "silver", "gold"
    )
  ) |>
  filter(
    str_starts(id, "48Z"),
    membership_status == "gold"
  )

suspect_member
```

-   Character (example must use functions from **stringr**)

```{r}
#| label: wd-4-string
# Lab 4: Question 4

ca_childcare <- ca_childcare |>
  mutate(
    county_name = str_remove(county_name, " County")
  )
```

-   Date (example must use functions from **lubridate**)

```{r}
#| label: wd-4-date
# Lab 5: Find Who Hired Jeremy Bowers

facebook_event_checkin <- facebook_event_checkin |>
  mutate(date = ymd(date))

```

**WD-5: I can use mutating joins to combine multiple dataframes.**

-   `left_join()` Example 1

```{r}
#| label: wd-5-left-ex-1
# Lab 4: Question 3

ca_childcare <- ca_childcare |>
  left_join(
    tax_rev,
    by = join_by(
      county_name == entity_name,
      study_year  == year
    )
  )

```

-   `right_join()` Example 1

```{r}
#| label: wd-5-right
# Lab 4: Question 3

ca_childcare <- tax_rev |>
  right_join(
    ca_childcare,
    by = join_by(
      entity_name == county_name,
      year        == study_year
    )
  )

```

-   `left_join()` **or** `right_join()` Example 2

```{r}
#| label: wd-5-left-right-ex-2
# Lab 5: Joining to Find Specific Person

suspect_pool <- concert_attendees |>
  left_join(
    y  = person,
    by = join_by(person_id == id)
  ) |>
  left_join(
    y  = drivers_license,
    by = join_by(license_id == id)
  )

```

-   `inner_join()` Example 1

```{r}
#| label: wd-5-inner-ex-1
# Lab 4: Question 2

ca_childcare <- counties |>
  filter(state_name == "California") |>
  inner_join(
    childcare_costs,
    by = join_by(county_fips_code == county_fips_code)
  )

```

-   `inner_join()` Example 2

```{r}
#| label: wd-5-inner-ex-2
# Lab 5: Interview Initial Suspect

suspect_interview <- suspect |>
  inner_join(
    interview,
    by = join_by(person_id == person_id)
  )
```

**WD-6: I can use filtering joins to filter rows from a dataframe.**

-   `semi_join()`

```{r}
#| label: wd-6-semi
# Lab 5: Interview Initial Suspect

suspect_with_interview <- suspect_info |>
  semi_join(interview, by = c("id" = "person_id"))

suspect_with_interview

```

-   `anti_join()`

```{r}
#| label: wd-6-anti
# Lab 5: Interview Initial Suspect

people_without_interview <- person |>
  anti_join(interview, by = c("id" = "person_id")) |>
  select(id, name, hair_color, height)

people_without_interview
```

**WD-7: I can pivot dataframes from long to wide and visa versa**

-   `pivot_longer()`

```{r}
#| label: wd-7-long
# Lab 3: Question 8

teacher_evals_clean |>
  filter(if_any(everything(), is.na)) |>
  summarize(
    across(everything(), ~ sum(is.na(.))),
    .groups = "drop"
  ) |>
  pivot_longer(
    everything(),
    names_to  = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0)

```

-   `pivot_wider()`

```{r}
#| label: wd-7-wide
# Lab 4: Question 5

income_2008_2018 <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(census_region, study_year) |>
  summarise(
    median_income_2018_dollars = median(mhi_2018, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from   = study_year,
    values_from  = median_income_2018_dollars,
    names_prefix = "Median income (2018 dollars) - "
  ) |>
  arrange(desc(`Median income (2018 dollars) - 2018`))
```

## Reproducibility

**R-1: I can create professional looking, reproducible analyses using RStudio projects, Quarto documents, and the here package.**

The following assignments satisfy the above criteria:

-   Example 1: Lab 1 – Introduction to Quarto
-   Example 2: Lab 2 – Exploring Rodents with ggplot2
-   Example 3: Lab 3 – Student Evaluations of Teaching
-   Example 4: Lab 7 – Functions + Fish
-   Example 5: Lab 9 & Challenge 9 – Searching for Efficiency & Making Great Tables

**R-2: I can write well documented and tidy code.**

-   Example of **ggplot2** plotting

```{r}
#| label: r-2-1
# Lab 4: Question 7

library(RColorBrewer)

recreate_plot <- ca_childcare |> 
  select(
    county_name, 
    study_year, 
    mc_infant, 
    mc_toddler, 
    mc_preschool, 
    census_region
  ) |>
  pivot_longer(
    cols = mc_infant:mc_preschool,
    names_to = "age",
    values_to = "price"
  ) |> 
  mutate(
    age = case_when(
      age == "mc_infant" ~ "Infant",
      age == "mc_toddler" ~ "Toddler",
      age == "mc_preschool" ~ "Preschool",
      TRUE ~ age
    ),
    census_region = fct_reorder2(
      .f = census_region, 
      .x = study_year, 
      .y = price, 
      .desc = TRUE
    )
  )

mycolors <- colorRampPalette(brewer.pal(7, "Accent"))(10)

ggplot(
  data = recreate_plot,
  mapping = aes(x = study_year, y = price, color = census_region)
) +
  geom_point(size = 0.75, alpha = 0.6) +
  geom_smooth(method = "loess", linewidth = 0.75, se = TRUE) +
  facet_wrap(~factor(age, levels = c("Infant", "Toddler", "Preschool"))) +
  scale_y_continuous(labels = scales::dollar_format(prefix = "$", big.mark = ",")) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    limits = c(2008, 2018)
  ) +
  scale_color_manual(values = mycolors) +
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) +
  theme_bw(base_size = 10) +
  theme(
    aspect.ratio = 1.25,
    axis.text.x = element_text(angle = 30)
  )
```

-   Example of **dplyr** pipeline

```{r}
#| label: r-2-2
# Lab 3: Question 5

teacher_evals_clean <- teacher_evals |>
  rename(sex = gender) |>
  filter(no_participants >= 10) |>
  mutate(
    teacher_id = as.character(teacher_id),
    course_id  = as.character(course_id)
  ) |>
  select(
    course_id,
    teacher_id,
    question_no,
    no_participants,
    resp_share,
    SET_score_avg,
    percent_failed_cur,
    academic_degree,
    seniority,
    sex
  )
```

-   Example of function formatting

```{r}
#| label: r-2-3
# Lab 8: Question 1

# Helper
rescale_01 <- function(x) {
  if (!is.numeric(x)) 
    stop("Input must be numeric.")
  if (length(x) <= 1) 
    stop("Input must have length > 1.")
  r <- range(x, na.rm = TRUE)
  (x - r[1]) / (r[2] - r[1])
}

# Main
rescale_column <- function(df, cols) {
  if (!is.data.frame(df))
    stop("Input must be a data frame.")

  df |>
    mutate(
      across(
        .cols = {{ cols }},
        .fns  = ~ rescale_01(.x)
      )
    )
}

```

**R-3: I can write robust programs that are resistant to changes in inputs.**

-   Example (any context)

```{r}
#| label: r-3-example
# Lab 8: Question 2

pivot_table <- function(df, row, col) {
  if (!is.data.frame(df)) {
    stop("Input must be a data frame.")
  }

  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(
      names_from  = {{ col }},
      values_from = n,
      values_fill = 0
    ) |>
    janitor::adorn_totals(c("row", "col"))
}
```

-   Example (function stops)

```{r}
#| label: r-3-function-stops
# Lab 8: Question 1
rescale_01 <- function(x) {
  if (!is.numeric(x)) 
    stop("Input must be numeric.")
  if (length(x) <= 1) 
    stop("Input must have length > 1.")
  r <- range(x, na.rm = TRUE)
  (x - r[1]) / (r[2] - r[1])
}
```

## Data Visualization & Summarization

**DVS-1: I can create visualizations for a *variety* of variable types (e.g., numeric, character, factor, date)**

-   At least two numeric variables

```{r}
#| label: dvs-1-num
# Lab 4: Question 8

ggplot(
  data = ca_childcare,
  mapping = aes(x = mhi_2018, y = mc_infant)
) +
  geom_point(
    alpha = 0.5,
    color = "darkgreen"
  ) +
  geom_smooth(
    method = "lm",
    se = TRUE,
    color = "gold"
  ) +
  labs(
    x = "Median household income (2018 dollars)",
    y = "Median weekly price (infant, center-based)",
    title = "Income vs. Infant Center-Based Weekly Price (CA, 2018)"
  ) +
  theme_bw(base_size = 10)
```

-   At least one numeric variable and one categorical variable

```{r}
#| label: dvs-2-num-cat
# lab 4: Question 7

ggplot(
  data = recreate_plot,
  mapping = aes(x = study_year, y = price, color = census_region)
) +
  geom_point(
    size = 0.75,
    alpha = 0.6
  ) +
  geom_smooth(
    linewidth = 0.75,
    se = TRUE
  ) +
  facet_wrap(
    ~factor(age, c("Infant", "Toddler", "Preschool"))
  ) +
  scale_y_continuous(
    labels = scales::dollar_format(prefix = "$", big.mark = ",")
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2),
    limits = c(2008, 2018)
  ) +
  scale_color_manual(
    values = mycolors
  ) +
  labs(
    title = "Weekly Median Price for Center-Based Childcare ($)",
    x = "Study Year",
    y = NULL,
    color = "California Region"
  ) +
  theme_bw(base_size = 10) +
  theme(
    aspect.ratio = 1.25,
    axis.text.x = element_text(angle = 30)
  )
```

-   At least two categorical variables

```{r}
#| label: dvs-2-cat
# Lab 3: Question 7

ggplot(
  data = teacher_evals_clean |>
    distinct(teacher_id, .keep_all = TRUE) |>
    count(academic_degree, sex),
  mapping = aes(x = academic_degree, y = n, fill = sex)
) +
  geom_col(
    position = "dodge"
  ) +
  labs(
    title = "Count of Instructors by Degree and Sex",
    x = "Academic Degree",
    y = "Number of Instructors",
    fill = "Sex"
  ) +
  theme_bw(base_size = 10)
```

-   Dates (time series plot)

```{r}
#| label: dvs-2-date
# lab 4: Question 7

ggplot(
  data = recreate_plot,
  mapping = aes(x = study_year, y = price, color = census_region)
) +
  geom_line() +
  geom_smooth(
    se = TRUE,
    alpha = 0.2
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, by = 2)
  ) +
  labs(
    x = "Study Year",
    y = "Median Weekly Price ($)",
    title = "Change in Childcare Costs Over Time by Region",
    color = "Region"
  ) +
  theme_bw(base_size = 10)
```

**DVS-2: I use plot modifications to make my visualization clear to the reader.**

-   I can modify my plot theme to be more readable

```{r}
#| label: dvs-2-ex-1
# Lab 7: Question 3

missing_summary <- fish |>
  group_by(year, section, trip) |>
  summarise(
    across(everything(), \(x) sum(is.na(x))),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols = -c(year, section, trip),
    names_to = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0) |>
  mutate(
    section = fct_infreq(as_factor(section)),
    trip    = fct_recode(
      as_factor(trip),
      "Trip 1" = "1",
      "Trip 2" = "2",
      "Trip 3" = "3"
    )
  )

# visualize
ggplot(missing_summary, aes(x = as_factor(year), y = num_missing, fill = section)) +
  geom_col(position = "dodge") +
  facet_wrap(~trip, ncol = 3, scales = "free_y") +
  labs(
    title    = "Missing Measurements in Blackfoot River Trout Study",
    subtitle = "Number of missing values by year, river section, and sampling trip",
    x        = "Year",
    y        = "",
    fill     = "River section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 6),
    axis.text.y = element_text(size = 6)
  )
```

-   I can modify my colors to be accessible to anyone's eyes

```{r}
#| label: dvs-2-ex-2
# Lab 4: Question 7

library(RColorBrewer)
mycolors <- colorRampPalette(brewer.pal(7, "Accent"))(10)
```

-   I can modify my plot titles to clearly communicate the data context

```{r}
#| label: dvs-2-ex-3
# Lab 7: Question 3

missing_summary <- fish |>
  group_by(year, section, trip) |>
  summarise(
    across(everything(), \(x) sum(is.na(x))),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols = -c(year, section, trip),
    names_to = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0) |>
  mutate(
    section = fct_infreq(as_factor(section)),
    trip    = fct_recode(
      as_factor(trip),
      "Trip 1" = "1",
      "Trip 2" = "2",
      "Trip 3" = "3"
    )
  )

# visualize
ggplot(missing_summary, aes(x = as_factor(year), y = num_missing, fill = section)) +
  geom_col(position = "dodge") +
  facet_wrap(~trip, ncol = 3, scales = "free_y") +
  labs(
    title    = "Missing Measurements in Blackfoot River Trout Study",
    subtitle = "Number of missing values by year, river section, and sampling trip",
    x        = "Year",
    y        = "",
    fill     = "River section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 6),
    axis.text.y = element_text(size = 6)
  )
```

-   I can modify the text in my plot to be more readable

```{r}
#| label: dvs-2-ex-4
# Lab 7: Question 3

missing_summary <- fish |>
  group_by(year, section, trip) |>
  summarise(
    across(everything(), \(x) sum(is.na(x))),
    .groups = "drop"
  ) |>
  pivot_longer(
    cols = -c(year, section, trip),
    names_to = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0) |>
  mutate(
    section = fct_infreq(as_factor(section)),
    trip    = fct_recode(
      as_factor(trip),
      "Trip 1" = "1",
      "Trip 2" = "2",
      "Trip 3" = "3"
    )
  )

# visualize
ggplot(missing_summary, aes(x = as_factor(year), y = num_missing, fill = section)) +
  geom_col(position = "dodge") +
  facet_wrap(~trip, ncol = 3, scales = "free_y") +
  labs(
    title    = "Missing Measurements in Blackfoot River Trout Study",
    subtitle = "Number of missing values by year, river section, and sampling trip",
    x        = "Year",
    y        = "",
    fill     = "River section"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(size = 6),
    axis.text.y = element_text(size = 6)
  )
```

-   I can reorder my legend to align with the colors in my plot

```{r}
#| label: dvs-2-ex-5
# Lab 4: Question 7

recreate_plot <- ca_childcare |>
  select(county_name, study_year, mc_infant, mc_toddler, mc_preschool, census_region) |>
  pivot_longer(
    cols = mc_infant:mc_preschool,
    names_to = "age",
    values_to = "price"
  ) |>
  mutate(
    age = case_when(
      age == "mc_infant" ~ "Infant",
      age == "mc_toddler" ~ "Toddler",
      age == "mc_preschool" ~ "Preschool",
      TRUE ~ age
    ),
    census_region = fct_reorder2(
      .f = census_region,
      .x = study_year,
      .y = price,
      .desc = TRUE
    )
  )
```

**DVS-3: I show creativity in my visualizations**

-   I can use non-standard colors (Example 1)

```{r}
#| label: dvs-3-1-ex-1
# Lab 4: Question 8

ggplot(
  data = ca_childcare,
  mapping = aes(x = mhi_2018, y = mc_infant)
) +
  geom_point(
    alpha = 0.5,
    color = "darkgreen"
  ) +
  geom_smooth(
    method = "lm",
    se = TRUE,
    color = "gold"
  ) +
  labs(
    x = "Median household income (2018 dollars)",
    y = "Median weekly price (infant, center-based)",
    title = "Income vs. Infant Center-Based Weekly Price (CA, 2018)"
  ) +
  theme_bw(base_size = 10)

```

-   I can use non-standard colors (Example 2)

```{r}
#| label: dvs-3-1-ex-2
# Lab 8: Question 4

library(RColorBrewer)

my_plot <- ggplot(
  data = penguins,
  mapping = aes(x = species, fill = sex)
) +
  geom_bar()

style_plot(
  my_plot,
  theme_fn  = theme_bw,
  palette   = brewer.pal(3, "Accent"),
  aesthetic = "fill"
)

```

-   I can use annotations (e.g., `geom_text()`)

```{r}
#| label: dvs-3-2

```

-   I can choose creative geometries (e.g., `geom_segment()`, `geom_ribbon)()`)

```{r}
#| label: dvs-3-3

```

**DVS-4: I can calculate numerical summaries of variables.**

-   Example using `summarize()`

```{r}
#| label: dvs-4-summarize
# Lab 3: Question 7

teacher_evals_clean |>
  distinct(teacher_id, .keep_all = TRUE) |>
  summarize(
    total_instructors = n(),
    avg_seniority = mean(seniority, na.rm = TRUE)
  )
```

-   Example using `across()`

```{r}
#| label: dvs-4-across
# Lab 3: Question 8

teacher_evals_clean |>
  summarise(
    across(
      .cols = everything(),
      .fns  = ~ sum(is.na(.x))
    )
  ) |>
  pivot_longer(
    cols      = everything(),
    names_to  = "variable",
    values_to = "num_missing"
  ) |>
  filter(num_missing > 0)

```

**DVS-5: I can find summaries of variables across multiple groups.**

-   Example 1

```{r}
#| label: dvs-5-1
# Lab 3: Question 11

one_year_fail <- teacher_evals_clean |>
  filter(seniority == 1) |>
  group_by(teacher_id) |>
  summarize(
    avg_fail = mean(percent_failed_cur, na.rm = TRUE),
    .groups = "drop"
  )

```

-   Example 2

```{r}
#| label: dvs-5-2
# Lab 4: Question 5

income_2008_2018 <- ca_childcare |>
  filter(study_year %in% c(2008, 2018)) |>
  group_by(census_region, study_year) |>
  summarise(
    median_income_2018_dollars = median(mhi_2018, na.rm = TRUE),
    .groups = "drop"
  ) |>
  pivot_wider(
    names_from   = study_year,
    values_from  = median_income_2018_dollars,
    names_prefix = "Median income (2018 dollars) - "
  ) |>
  arrange(desc(`Median income (2018 dollars) - 2018`))

```

**DVS-6: I can create tables which make my summaries clear to the reader.**

-   I can modify my column names to clearly communicate the data context

```{r}
#| label: dvs-6-ex-1
# Lab 4: Challenge 4

summary_tbl |>
  mutate(
    study_year = as.character(study_year)
  ) |>
  mutate(
    across(
      .cols = c(center, family, gap),
      .fns = scales::dollar
    )
  ) |>
  rename(
    Year = study_year,
    `Center-Based Care ($)` = center,
    `Family/In-Home Care ($)` = family,
    `Price Gap ($)` = gap
  )
```

-   I can modify the text in my table to be more readable (e.g., bold face for column headers)

```{r}
#| label: dvs-6-ex-2
# Lab 9: Question 6

unformatted_summary_table |>
  arrange(variable, level) |>
  mutate(
    Percent = scales::percent(prop, accuracy = 0.1),
    Level   = level,
    Count   = n
  ) |>
  select(Level, Count, Percent) |>
  kbl(
    col.names = c("Level", "Count", "Percent"),
    caption   = "Demographics of Professors at the University of Poland, Warsaw in 2020"
  ) |>
  add_header_above(
    c(" " = 1, "Instructor Distribution" = 2)
  ) |>
  kable_styling(
    full_width = FALSE,
    bootstrap_options = c("striped", "hover", "condensed")
  ) |>
  pack_rows("Academic Degree", 1, 4) |>
  pack_rows("Seniority",5, 7) |>
  pack_rows("Sex",8, 9)

```

-   I can arrange my table to have an intuitive ordering

```{r}
#| label: dvs-6-ex-3
# Lab 3: Question 7

teacher_evals_clean |>
  distinct(teacher_id, .keep_all = TRUE) |>
  summarize(
    total_instructors = n(),
    avg_seniority = mean(seniority, na.rm = TRUE)
  )

teacher_evals_clean |>
  distinct(teacher_id, .keep_all = TRUE) |>
  count(academic_degree, sex, name = "Instructor_Count") |>
  mutate(
    Percent = round((Instructor_Count / sum(Instructor_Count)) * 100, 1)
  ) |>
  arrange(desc(Percent)) |>
  rename(
    Academic_Degree = academic_degree,
    Sex = sex
  ) |>
  select(
    Academic_Degree,
    Sex,
    Instructor_Count,
    Percent
  )

```

**DVS-7: I show creativity in my tables.**

-   I can use non-default colors

```{r}
#| label: dvs-7-ex-1
# Lab 9: Question 8

fish |>
  map_int(.f = ~ sum(is.na(.x))) |>
  enframe(
    name  = "Measurement Variable",
    value = "Missing Values"
  ) |>
  arrange(desc(`Missing Values`)) |>
  gt() |>
  tab_header(
    title    = "Number of Missing Values for Fish Measurements",
    subtitle = "Data collected from 1989 to 2006 on the Blackfoot Fish River in Montana"
  ) |>
  data_color(
    columns = `Missing Values`,
    colors = function(x) case_when(
      x == 0 ~ "darkgreen",
      TRUE   ~ "darkred"
    )
  )

```

-   I can modify the layout of my table to be more readable (e.g., `pivot_longer()` or `pivot_wider()`)

```{r}
#| label: dvs-7-ex-2
# Lab 8: Question 2

pivot_table <- function(df, row, col) {
  if (!is.data.frame(df)) {
    return("Input must be a data frame.")
  }

  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(
      names_from  = {{ col }},
      values_from = n,
      values_fill = 0
    ) |>
    janitor::adorn_totals(c("row", "col"))
}

pivot_table(penguins, row = sex, col = species)

```

## Program Efficiency

**PE-1: I can write concise code which does not repeat itself.**

-   using a single function call with multiple inputs (rather than multiple function calls)

```{r}
#| label: pe-1-one-call
# Lab 4: Question 7

recreate_plot <- ca_childcare |>
  select(
    county_name,
    study_year,
    mc_infant,
    mc_toddler,
    mc_preschool,
    census_region
  ) |>
  pivot_longer(
    cols = c(mc_infant, mc_toddler, mc_preschool),
    names_to = "age",
    values_to = "price"
  )

```

-   using `across()`

```{r}
#| label: pe-1-across
# Lab 4: Challenge 4

summary_tbl |>
  mutate(
    study_year = as.character(study_year),
    across(
      .cols = c(center, family, gap),
      .fns = scales::dollar
    )
  )
```

-   using functions from the `map()` family

```{r}
#| label: pe-1-map-1
# Lab 9: Question 2

lab2_table <- surveys |>
  map_chr(.f = ~ class(.x)) |>
  enframe(
    name  = "Variable",
    value = "Data Type"
  )

lab2_table |>
  kbl(caption = "Data type of each variable in the surveys dataset") |>
  kable_minimal()

```

**PE-2: I can write functions to reduce repetition in my code.**

-   Example 1: Function that operates on vectors

```{r}
#| label: pe-2-1
# Lab 8: Question 1

# Helper
rescale_01 <- function(x) {
  if (!is.numeric(x)) 
    return("Input must be numeric.")
  if (length(x) <= 1) 
    return("Input must have length > 1.")
  r <- range(x, na.rm = TRUE)
  (x - r[1]) / (r[2] - r[1])
}

# Main
rescale_column <- function(df, cols) {
  if (!is.data.frame(df))
    return("Input must be a data frame.")

  df |>
    mutate(
      across(
        .cols = {{ cols }},
        .fns  = ~ rescale_01(.x)
      )
    )
}

rescale_column(penguins, 
               cols = c(bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g)
               )
```

-   Example 2: Function that operates on data frames

```{r}
#| label: pe-2-2
# Lab 8: Question 2

pivot_table <- function(df, row, col) {
  if (!is.data.frame(df)) {
    stop("`df` must be a data frame.")
  }

  df |>
    count({{ row }}, {{ col }}) |>
    pivot_wider(
      names_from  = {{ col }},
      values_from = n,
      values_fill = 0
    ) |>
    janitor::adorn_totals(c("row", "col"))
}

pivot_table(penguins, row = sex, col = species)

```

-   Example 3: Function that operates on vectors *or* data frames

```{r}
#| label: pe-2-3
# Lab 8: Question 4

style_plot <- function(p,
                       theme_fn = theme_minimal,
                       palette  = RColorBrewer::brewer.pal(8, "Accent"),
                       aesthetic = "fill") {  
  p <- p + theme_fn()

  if (aesthetic == "fill") {
    p <- p + scale_fill_manual(values = palette)
  } else if (aesthetic == "color") {
    p <- p + scale_color_manual(values = palette)
  } else {
    stop('aesthetic must be "fill" or "color"')
  }
  p
}

my_plot <- ggplot(penguins, mapping = aes(x = species, fill = sex)) + 
  geom_bar()

style_plot(my_plot, 
           theme_fn = theme_bw, 
           palette = brewer.pal(3, "Accent"), 
           aesthetic = "fill")

```

**PE-3:I can use iteration to reduce repetition in my code.**

-   using `across()`

```{r}
#| label: pe-3-across
# Lab 4: Challenge 4

summary_tbl |>
  mutate(
    study_year = as.character(study_year)
  ) |>
  mutate(
    across(
      .cols = c(center, family, gap),
      .fns = scales::dollar
    )
  ) |>
  rename(
    Year = study_year,
    `Center-Based Care ($)` = center,
    `Family/In-Home Care ($)` = family,
    `Price Gap ($)` = gap
  ) |>
  arrange(Year)
```

-   using a `map()` function with **one** input (e.g., `map()`, `map_chr()`, `map_dbl()`, etc.)

```{r}
#| label: pe-3-map-1
# Lab 9: Revisit of Lab 2, Question 2

lab2_table <- surveys |>
  map_chr(.f = ~ class(.x)) |>
  enframe(name = "Variable",
          value = "Data Type")|>
    mutate(`Data Type` = str_to_lower(`Data Type`))


lab2_table |>
  kbl(caption = "Data type of each variable in the surveys dataset") |>
  kable_minimal()

```

-   using a `map()` function with **more than one** input (e.g., `map_2()` or `pmap()`)

```{r}
#| label: pe-3-map-2
# Lab 9: Revisit of Lab 3, Question 4

evals_fct <- evals |>
  map_if(
    .p = is.character,
    .f = as.factor
  ) |>
  bind_cols()

```

**PE-4: I can use modern tools when carrying out my analysis.**

-   I can use functions which are not superseded or deprecated

```{r}
#| label: pe-4-1
# Lab 4: Question 3

ca_childcare <- ca_childcare |>
  left_join(
    tax_rev,
    by = join_by(
      county_name == entity_name,
      study_year  == year
    )
  )

```

-   I can connect a data wrangling pipeline into a `ggplot()`

```{r}
#| label: pe-4-2
# Lab 4: Challenge 4

ca_childcare |>
  summarise(
    gap = median(mc_infant - mfcc_infant, na.rm = TRUE),
    .by = c(census_region, study_year)
  ) |>
  ggplot(
    data = _,
    mapping = aes(
      x = study_year,
      y = gap,
      color = census_region
    )
  ) +
  geom_line() +
  geom_smooth(
    se = TRUE,
    alpha = 0.1
  ) +
  scale_y_continuous(
    labels = dollar
  ) +
  scale_x_continuous(
    breaks = seq(2008, 2018, 2)
  ) +
  labs(
    title = "Infant Care Price Gap in California: Center vs Family (by Census Region)",
    subtitle = "Median weekly price gap (Center − Family), 2008–2018",
    x = "Year",
    y = "Median gap (USD)",
    color = "Region"
  ) +
  theme_bw()
```

## Data Simulation & Statisical Models

**DSSM-1: I can simulate data from a *variety* of probability models.**

-   Example 1

```{r}
#| label: dsm-1-1
# Lab 10: Question 1

randomBabies <- function(n_babies = 4) {
  
  babies <- tibble(
    parent = 1:n_babies,
    baby = sample(1:n_babies,
                    size = n_babies,
                    replace = FALSE)
  )
  
  babies |>
    mutate(correct = parent == baby) |>
    summarise(n_correct = sum(correct)) |>
    pull(n_correct)
}

set.seed(0912)
results <- map_int(.x = 1:10000,
                   .f = ~ randomBabies(n_babies = 4)
)
```

-   Example 2

```{r}
#| label: dsm-1-2
# Lab 10: Question 8 & 10

mycifun <- function(beta0, beta1, n) {
  # generate x vector
  x <- runif(n, min = 0, max = 1)
  
  # generate noise (sigma^2 = 1 -> sd = 1)
  ep <- rnorm(n, mean = 0, sd = 1)
  
  # generate outcome from population model
  y <- beta0 + beta1 * x + ep
  
  # fit linear model
  model <- lm(y ~ x)
  
  # extract slope estimate + CI and check coverage
  tidy(model,
       conf.int  = TRUE,
       conf.level = 0.95) |>
    filter(term == "x") |>
    select(estimate, conf.low, conf.high) |>
    mutate(
      cover = case_when(
        conf.low <= beta1 & beta1 <= conf.high ~ 1,
        .default = 0
      )
    )
}

set.seed(0129)
ci_dat <- map(.x = 1:1000,
              .f = ~ mycifun(beta0 = 3, beta1 = 0.5, n = 100)
              )

```

**DSSM-2: I can conduct common statistical analyses in R.**

-   Example 1

```{r}
#| label: dsm-2-1
# Lab 1: Comparing Supplement Methods with a t-test

t.test(
  formula = len ~ supp,
  data = ToothGrowth,
  var.equal = FALSE,
  alternative = "two.sided"
)
```

-   Example 2

```{r}
#| label: dsm-2-2
# Lab 2: Question 17

species_mod <- aov(
  formula = weight ~ species,
  data = surveys
)

summary(
  object = species_mod
)
```

-   Example 3

```{r}
#| label: dsm-2-3
# Lab 4: Question 9

reg_mod1 <- lm(
  formula = mc_infant ~ mhi_2018,
  data = ca_childcare
)

summary(
  object = reg_mod1
)
```

## Revising My Thinking

<!-- How did you revise your thinking throughout the course? How did you revise your thinking on the code examples you have provided in your portfolio? -->

<!-- For the revisions included in your Portfolio, to help me understand the nature of your revisions, please denote somehow the feedback I provided you (e.g., boldface, italics, colored text) before your revisions. -->

## Extending My Thinking

<!-- How did you extended your thinking throughout the course? How did you extend your thinking on the code examples you have provided in your portfolio? -->

## Peer Support & Collaboration

<!-- Include an image or a description of feedback you gave that you are proud of (either in a peer review or in Discord). -->

<!-- Include a description of how you grew as a collaborator through the weekly pair programming activities.   -->
